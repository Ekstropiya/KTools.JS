'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _is = require('../../is');

var _funcs = require('../../shared/funcs');

var _funcs2 = _interopRequireDefault(_funcs);

var _splitter = require('../helper/splitter');

var _splitter2 = _interopRequireDefault(_splitter);

var _processor = require('../helper/processor');

var _processor2 = _interopRequireDefault(_processor);

var _resolver = require('./resolver');

var _resolver2 = _interopRequireDefault(_resolver);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * no default value.
 * @param {string}
 * @param {object}
 * @param {char}
 */
var laterAgo = function laterAgo(opt, argOptions, reqMathType) {
  // validate
  if (!(0, _is.isValid)(opt)) return (0, _funcs2.default)(opt);
  if (typeof opt !== 'string') return (0, _funcs2.default)(opt);
  var options = opt.trim();
  // split numbers from formats

  var _splitter$numFromForm = _splitter2.default.numFromFormat(options),
      formats = _splitter$numFromForm.formats,
      times = _splitter$numFromForm.times;
  // not valid opt?


  if (!formats) return (0, _funcs2.default)(opt);
  // get timeConstants and  expectedTSfunc for time and day reuest,
  // dateUnit for months and year

  var _processor$general = _processor2.default.general(formats),
      timeConstants = _processor$general.timeConstants,
      expectedTSfunc = _processor$general.expectedTSfunc,
      dateUnit = _processor$general.dateUnit;
  // it should return either timeConstants or expectedCountfunc.
  // both not true, the opt is not valid.


  if (!timeConstants && !dateUnit) return (0, _funcs2.default)(opt);
  // did the user send ts request?
  var resultForm = void 0;
  if (argOptions) {
    if (argOptions.match(/ts/ig)) {
      resultForm = 'ts';
    } else if (argOptions.match(/(?:\bf\b|\bfull\b|\bfull date\b|\bfull dates\b|\bfulldate\b|\bfulldates\b)/ig)) {
      resultForm = 'fulldate';
    } else {
      return (0, _funcs2.default)(argOptions);
    }
  } else {
    resultForm = 'num';
  }
  return (0, _resolver2.default)(timeConstants, times, expectedTSfunc, dateUnit, reqMathType, resultForm);
};

exports.default = laterAgo;