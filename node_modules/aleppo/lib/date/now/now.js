'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _is = require('../../is');

var _funcs = require('../../shared/funcs');

var _funcs2 = _interopRequireDefault(_funcs);

var _splitter = require('../helper/splitter');

var _splitter2 = _interopRequireDefault(_splitter);

var _processor = require('../helper/processor');

var _processor2 = _interopRequireDefault(_processor);

var _readableDate = require('../helper/generator/readableDate');

var _readableDate2 = _interopRequireDefault(_readableDate);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var multi = function multi(formatsArray, seperator) {
  var result = '';
  var singleValue = void 0;
  var isErr = [];
  for (var i = 0; i < formatsArray.length; i += 1) {
    var _processor$general = _processor2.default.general(formatsArray[i]),
        expectedTSfunc = _processor$general.expectedTSfunc;

    if (expectedTSfunc) {
      singleValue = _readableDate2.default[expectedTSfunc](new Date().getTime());
    } else {
      singleValue = false;
    }
    // check if result false then the format false
    isErr[i] = singleValue === false;
    result += singleValue;
    // Dont add seperator to the last.
    if (formatsArray.length - 1 !== i) {
      result += seperator;
    }
  }
  // if all the results are fale so return false/
  if (isErr.includes(false)) {
    return result;
  }
  return false;
};

/**
 * main function
 *
 * @param {string} opt - inquiry option. day/month/year/hours..
 * no need to validate opt, beacuse it has default value.
 * @returns {string} - date in matching inquiry form.
 **/

var now = function now() {
  var opt = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'local';

  if (typeof opt !== 'string') return (0, _funcs2.default)(opt);
  var options = opt.trim();
  // split the format to fractions.

  var _splitter$formatReque = _splitter2.default.formatRequest(options),
      formatsArray = _splitter$formatReque.formatsArray,
      separator = _splitter$formatReque.separator;

  var value = void 0;
  // if separator length is zero, the request is required only single function.
  if (separator.length === 0) {
    var _processor$general2 = _processor2.default.general(formatsArray),
        expectedTSfunc = _processor$general2.expectedTSfunc;

    if (!expectedTSfunc) return (0, _funcs2.default)(opt);
    value = _readableDate2.default[expectedTSfunc](new Date().getTime());
  } else {
    value = multi(formatsArray, separator);
  }
  if ((0, _is.isValid)(value) && value !== false) {
    return value;
  }
  return (0, _funcs2.default)(opt);
};

exports.default = now;